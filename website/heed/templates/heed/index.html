
<!-- 
FOLLOWING THIS:  
https://stackoverflow.com/questions/16413063/html5-record-audio-to-file 
-->


<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Key-word Spotting</title>
        <meta name="A application detection when a key-word is spotted." content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
    </head>
    <body>
        {% load static %}
        <script type="text/javascript" src="{% static 'js/recorderWorker.js' %}"> </script>
        <fieldset><legend>RECORD AUDIO</legend>
    		<input onclick="startRecording()" type="button" value="start recording" />
    		<input onclick="stopRecording()" type="button" value="stop recording and play" />
        </fieldset>
        
        <script>
            var onFail = function(e) {
                console.log('Rejected!', e);
            };

            var onSuccess = function(s) {
                var context = new webkitAudioContext();
                var mediaStreamSource = context.createMediaStreamSource(s);
                recorder = new Recorder(mediaStreamSource);
                recorder.record();

                // audio loopback
                // mediaStreamSource.connect(context.destination);
            }

            window.URL = window.URL || window.webkitURL;
            navigator.getUserMedia  = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

            var recorder;
            var audio = document.querySelector('audio');

            function startRecording() {
                if (navigator.getUserMedia) {
                    navigator.getUserMedia({audio: true}, onSuccess, onFail);
                } else {
                    console.log('navigator.getUserMedia not present');
                }
            }

            function stopRecording() {
                recorder.stop();
                recorder.exportWAV(function(s) {
                            
                                 audio.src = window.URL.createObjectURL(s);
                });
            }
        </script>       
        
        
        <h1>Key-word spotting on an audio stream</h1>
        <p id="status"> Connection status will go here</p>
        <p id="spot-plot"></p> 
        <img src="data:image/png;base64,{{ image_uri }}" id="prediction_barchart_id"> 
        
        <!-- <form method="post" action="/upload" enctype="multipart/form-data">
            <label>Audio File: </label>
            <input type="file" name="user_audio"/>
            <br>
            <input value="Upload" type="submit">
          </form> -->
         </body>
</html>